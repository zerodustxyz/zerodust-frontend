# API Reference

Base URL: `https://api.zerodust.xyz`

## Authentication

Optional API key via header:

```
X-API-Key: your-api-key
```

API keys provide higher rate limits but are not required.

## Endpoints

### GET /chains

List supported chains.

**Response:**
```json
{
  "chains": [
    {
      "chainId": 8453,
      "name": "Base",
      "nativeToken": "ETH",
      "nativeTokenDecimals": 18,
      "minBalance": "10000000000000",
      "contractAddress": "0x3732398281d0606aCB7EC1D490dFB0591BE4c4f2",
      "explorerUrl": "https://basescan.org",
      "enabled": true
    }
  ]
}
```

### GET /balances/:address

Get balances across all chains for an address.

**Parameters:**
- `address` (path) - Ethereum address (0x...)

**Response:**
```json
{
  "address": "0x...",
  "chains": [
    {
      "chainId": 42161,
      "name": "Arbitrum",
      "nativeToken": "ETH",
      "balance": "800000000000000",
      "balanceFormatted": "0.0008",
      "canSweep": true,
      "minBalance": "10000000000000"
    }
  ]
}
```

### GET /quote

Get a sweep quote.

**Query parameters:**
- `fromChainId` (number) - Source chain ID
- `toChainId` (number) - Destination chain ID
- `userAddress` (string) - User's address
- `destination` (string) - Destination address

**Response:**
```json
{
  "quoteId": "uuid",
  "version": 2,
  "userBalance": "800000000000000",
  "estimatedReceive": "750000000000000",
  "mode": 1,
  "fees": {
    "overheadGasUnits": "300000",
    "protocolFeeGasUnits": "0",
    "extraFeeWei": "5000000000000",
    "reimbGasPriceCapWei": "100000000",
    "maxTotalFeeWei": "50000000000000",
    "revokeGasUnits": "50000"
  },
  "autoRevoke": true,
  "intent": {
    "mode": 1,
    "destination": "0x...",
    "destinationChainId": "8453",
    "callTarget": "0x...",
    "routeHash": "0x...",
    "minReceive": "700000000000000"
  },
  "deadline": 1707782400,
  "nonce": 0,
  "authNonce": 5,
  "validForSeconds": 60
}
```

### POST /authorization

Create EIP-712 typed data for signing.

**Body:**
```json
{
  "quoteId": "uuid"
}
```

**Response:**
```json
{
  "sweepType": "cross-chain",
  "typedData": {
    "types": { ... },
    "primaryType": "SweepIntent",
    "domain": {
      "name": "ZeroDust",
      "version": "2",
      "chainId": 42161,
      "verifyingContract": "0x..."
    },
    "message": { ... }
  },
  "contractAddress": "0x3732398281d0606aCB7EC1D490dFB0591BE4c4f2",
  "version": 2
}
```

### POST /sweep

Submit a signed sweep.

**Body:**
```json
{
  "quoteId": "uuid",
  "signature": "0x...",
  "eip7702Authorization": {
    "chainId": 42161,
    "contractAddress": "0x...",
    "nonce": 5,
    "yParity": 0,
    "r": "0x...",
    "s": "0x..."
  },
  "revokeAuthorization": { ... }
}
```

**Response:**
```json
{
  "sweepId": "uuid",
  "status": "pending",
  "sweepType": "cross-chain",
  "isExisting": false,
  "version": 2
}
```

### GET /sweep/:sweepId

Get sweep status.

**Response:**
```json
{
  "sweepId": "uuid",
  "status": "completed",
  "sweepType": "cross-chain",
  "mode": 1,
  "txHash": "0x...",
  "destination": "0x...",
  "fromChainId": 42161,
  "toChainId": 8453,
  "amountSent": "800000000000000",
  "bridgeTrackingUrl": "https://...",
  "version": 2,
  "createdAt": "2025-01-15T10:30:00Z",
  "updatedAt": "2025-01-15T10:31:00Z",
  "revokeStatus": "completed"
}
```

### GET /sweeps/:address

List sweeps for an address.

**Query parameters:**
- `limit` (number, optional) - Max results (default: 20, max: 100)
- `offset` (number, optional) - Pagination offset
- `status` (string, optional) - Filter by status

**Response:**
```json
{
  "sweeps": [
    {
      "sweepId": "uuid",
      "status": "completed",
      "sweepType": "cross-chain",
      "mode": 1,
      "fromChainId": 42161,
      "toChainId": 8453,
      "amountSent": "800000000000000",
      "txHash": "0x...",
      "version": 2,
      "createdAt": "2025-01-15T10:30:00Z"
    }
  ],
  "total": 5
}
```

## Error responses

All errors follow this format:

```json
{
  "error": "Human-readable error message",
  "code": "BALANCE_TOO_LOW"
}
```

| HTTP Status | Code | Description |
|-------------|------|-------------|
| 400 | `BALANCE_TOO_LOW` | Balance insufficient for sweep |
| 400 | `QUOTE_EXPIRED` | Quote has expired |
| 400 | `INVALID_ADDRESS` | Invalid Ethereum address |
| 400 | `CHAIN_NOT_SUPPORTED` | Chain ID not supported |
| 400 | `INVALID_SIGNATURE` | Invalid EIP-712 signature |
| 404 | `QUOTE_NOT_FOUND` | Quote ID not found |
| 503 | `SERVICE_UNAVAILABLE` | Service temporarily down |
